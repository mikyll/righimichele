<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
	<title>VacuumCleaner</title>
</head>
    
<body>
<!--<tt>tt</tt><br/>
<em>em</em><br/>
<bc>bc</bc><br/>
<ks>ks</ks><br/>
<kc>kc</kc><br/>
<m>m</m><br/>
<k>k</k><br/>
<br/>
<br/>-->
<div id="top">
<h1>VacuumCleaner - ISS M 2022<font size="5"></font> </h1>
</div>

<div class="body"> 

<h2>Introduction</h2>
<div class="remark">
Homework for 25/04/2022.<br/><br/>
Carry out the requirement analysis, project analysis and test plan of a software that manages the movements of an automatic vacuum cleaner.<br/>
The vacuum cleaner is represented by a virtual robot that receives messages over HTTP or websocket and move/behave accordingly to those. The space in which the robot can move is surrounded by 4 walls that makes the room rectangular, and there might be static obstacles with which the robot collides.
</div>
 
<h2>Requirements</h2>
<div class="remark">
Make a <ks>software application</ks> that gives a specific sequence of moves to a robot, so that it moves covering the whole surface of a rectangular room (i.e. the robot must travel accross every piece of the room).<br/>
The room is surrounded by 4 walls, and the robot has sensors to detect when a collision with an obstacle occurs.
</div>


<h2>Requirement analysis</h2>
<div class="remark">
The customer wants a software application which, communicating via HTTP or websocket with a module provided by him (Virtual Environment - <ks>WEnv</ks>), sends a sequence of commands that the robot must perform in order to "clean the room completely".<br/>
By "cleaning the room completely" the customer means that the robot must travel through the whole surface of the room, which is surrounded by 4 static walls.<br/>
<br/>
Therefore, it is necessary to create a <em><b>VacuumCleaner</b></em> component which sends a sequence of commands to the WEnv, which makes the robot move according to those specific instructions, by covering the whole area of the room.
<br/><br/>

<ul>
	<li>The entity involved for the moment has no nature, and so we consider it to be a <ks>generic entity</ks>. <!--, since it is logically active (has an autonomous flow of control), is capable of sending messages to another actor (the WEnv/real robot), ...--></li>
	<li>The application and the virtual robot can run on different devices, but initially it's sufficient to work locally on a single machine.</li>
	<li>There are not technologic constraint but it's possible to use libs provided by the customer/company (<ks>unibolibs</ks>) that can be useful to complete the task (e.g. the communication module).</li>
	<li>In order to being able to implement the communication properly, it is necessary to respect the interaction model with which the WEnv is able to communicate, as described in <a href="unibo.issLabStart/userDocs/Dispense/html/VirtualRobot.html">this document</a>.</li>
	<!--<li>In the future there could be an additional commission: a command to pause and resume the robot task, making it "go home" and returning back to its place.</li>-->
</ul>
</div>

<h3>Use Case</h3>
<img src="img/use_case.png"/>

<h3>User Story</h3>
<div class="remark">
<table>
	<tr>
		<td width="50%" style="padding: 5pt">
			The user places the robot in a fixed and well known spot (home position, e.g. the upper-left corner), then he runs the VacuumCleaner application.<br/>
			The application will communicate with the WEnv or the real robot, making it move following a certain pattern that we are sure is effective for cleaning the whole room, without leaving dirty (blank) spots.
		</td>
		<td width="50%" style="padding: 5pt">
			<img width="99%" src="img/PercorsoAspirapolvere.png"/>
		</td>
	</tr>
</table>
</div>


<h2>Problem analysis</h2>
<div class="remark">
The requirements locate several <bc>potential issues</bc>:
<ol>
<li>
		<kc>COMMUNICATION</kc>: according to <a href="unibo.issLabStart/userDocs/Dispense/html/VirtualRobot.html">VirtualRobot2021</a>, provided by the customer, the robot can receive move commands in two different ways:
		<ul>
			<li>by sending <ks>HTTP POST</ks> requests on port 8090;</li>
			<li>by sending messages on a <ks>websocket</ks> on port 8091.</li>
		</ul>
		
		Which one should we use? For simplicity, we initially choose to <b>communicate synchronously</b>, since we expect a response to each message sent to the robot (to check if a collision occurred). If in the future the customer will ask for an additional stop/resume mechanism, we would then be bound to use an asynchronous communication, since we will want to be able to stop the robot at any time.
	</li>
	<!--<li>
		<kc>COMUNICAZIONE</kc>: secondo <a href="unibo.issLabStart/userDocs/Dispense/html/VirtualRobot.html">VirtualRobot2021</a>, fornito dal customer, il robot può ricevere comandi di movimento in due modi differenti:
		<ul>
			<li>Via messaggi <ks>HTTP POST</ks> sulla porta 8090;</li>
			<li>via messaggi su <ks>websocket</ks> sulla porta 8091.</li>
		</ul>
		
		È meglio la comunicazione sincrona o asincrona? Per semplicità, inizialmente scegliamo di comunicare in modo sincrono, in quanto prevediamo una risposta a ciascun messaggio inviato al robot (per controllare se c'è stata la collisione). Se in futuro prevedessimo un meccanismo di stop/resume, saremmo allora vincolati all'utilizzo di una comunicazione asincrona.
	</li>-->
	<li>
		<kc>PATH AND ALGORITHM</kc>: the choice of the path the robot must follow. For simplicity, for the moment we take for granted that there are no obstacles inside the room, except the 4 walls that surround it. Moreover, let's suppose that the robot starting position is fixed and well known, for example the upper-left corner, which we can call "<tt>den</tt>". In this way, the path choice becomes trivial, as it is possible to adopt a "<b>zig-zag pattern</b>": the robot moves forward until it encounters an obstacle (i.e. the wall), then rotates by 90° in order to face the area of the room yet to be explored (in our example that direction is the right). Then the robot should move by a step, and rotate again by 90° in the opposite direction. Then it can start moving forward again until it collides with a wall and so on.<br/>
		In this regard, we can exploit the robot collision detection mechanism, to know when a wall has been collided with, and rotate the robot accordingly.
	</li>
	<!--<li>
		<kc>PERCORSO</kc>: la scelta del percorso da effettuare. Per semplicità, per il momento consideriamo il caso in cui non ci siano ostacoli all'interno della stanza. Supponiamo in oltre, che il robot parta da una posizione nota, che chiamiamo "home", ovvero l'angolo in alto a sinistra della stanza. In questo modo, la scelta del percorso diventa banale, in quanto è possibile  seguire un pattern "a zig-zag": il robot si muove in avanti finché non incontra un ostacolo (i.e. il muro), dopodiché ruota di 90° in modo da essere rivolto verso la direzione ancora non esplorata (nel nostro esempio è a destra).
		
		A tal proposito si può sfruttare il meccanismo del robot di rilevazione delle collisioni, per sapere quando è stato colpito un muro, e ruotare il robot di conseguenza.
	</li>-->
	<li>
		<kc>STATE</kc>: we must ensure that the robot doesn't leave blank spots. It is possible to dynamically build a data structure, such as a <b>map</b>, marking the spots where the robot has already passed. Assuming that the room can be represented in a Cartesian plane, we can think that each space is identifiable by 2 coordinates X and Y, and is equal to the dimensions of the robot (length and width). As the robot progresses, we insert a particular element in the map that indicates the status of the box, for example a different character wheter it has already been visited or is still to be visited. When the robot hits the first bottom wall, the we know the map row number.<br/>
		Once the map is completed, we can simply check if each element of the map is filled with the "visited" character, to test the correctness of the solution.
	</li>
	<!--<li>
		<kc>STATO</kc>: è necessario assicurarsi che il robot non lasci spazi vuoti. È possibile creare una mappatura dinamica della stanza, segnando gli spazi in cui il robot è già passato. Supponendo che la stanza sia rappresentabile in un piano cartesiano, possiamo pensare che ciascuno spazio sia individuabile da due coordinate X e Y, e sia pari alle dimensioni del robot (lunghezza e larghezza). Man mano che il robot procede, inseriamo nella mappa un carattere che indica lo stato della casella, ad esempio se è stata già visitata o è ancora da visitare. When the robot hits the first bottom wall, the we know the map .
		Once the map is completed, we can simply check if each element of the map is filled with the "visited" character.
	</li>-->
	<li>
		<kc>DISTANCE</kc>: it is necessary to calculate the distance to be covered by the robot for each step. This way we can make the robot move for an amount of time which corresponds exactly to the robot length.
	</li>
</ol>
</div>

<h3>Logical Architecture</h3>
<div class="remark">
<table>
	<tr>
		<td style="padding: 15pt">Legend</td>
		<td><img width="99%" src="img/legenda.png"/></td>
	</tr>
	<tr>
		<td width="50%" style="padding: 5pt">
			We must design and build a distributed system with 2 software macro-components:
			<ol>
				<li>the Virtual Robot, given by the customer</li>
				<li>the <em><b>vacuumCleaner</b></em> application that interacts with the robot</li>
			</ol>
			A first scheme of the logical architecture of the systems can be defined as shown in the figure.
		</td>
		<td width="50%" style="padding: 5pt">
			<img width="99%" src="img/architettura_logica.png"/>
		</td>
	</tr>
</table>
</div>

<!--definire/chiarire le problematiche implicate dai requisiti.

fornire informazioni utili sui costi/tempi/risorse necessari.


<h3>risorse umane e temporali necessarie</h3>-->


<h2>Test plans</h2>
<div class="remark">
</div>
To test the behaviour of the robot we can track its movement by saving each completed command into a String. For example, if the robot moves forward for 3 times and then rotates left, we will have a string equal to "fffl".<br/><br/>

<pre>
Moves legend:
moveForward = f, rotateLeft = l, rotateRight = r
</pre>

<pre>
public class TestVacuumCleaner {
    private final static int DOWN = 0, RIGHT = 1, UP = 2, LEFT = 3;
    private final String localHostName = "localhost";
    private final int port = 8090;
    private final String HttpURL = "http://" + localHostName + ":" + port + "/api/move";

    private Interaction2021 conn;
    private String cleaned;
    private int curX, curY, heading;

    @Before
    public void init() {
        // setup string
        cleaned = "";

        // set robot position to DEN
        curX = 0;
        curY = 0;
        heading = DOWN;

        // enstablish connection
        conn = HttpConnection.create(localHostName + ":" + port);
    }

    @Test
    public void testCleaning() throws Exception {
        boolean obstacle = false;
        String answer = "";
        while(true)
        {
            while(!obstacle)
            {
                answer = conn.request( "{\"robotmove\":\"moveForward\", \"time\":50}");
                obstacle = answer.contains("collision");
                cleaned += obstacle ? "f" : "";
            }
            obstacle = false;
            if(heading == DOWN)
            {
                // rotate left by 90°
                conn.request( "{\"robotmove\":\"turnLeft\", \"time\":300}");
                cleaned += "l";

                // step forward
                answer = conn.request( "{\"robotmove\":\"moveForward\", \"time\":50}");
                if(answer.contains("collision"))
                    break;
                else cleaned += "f";

                // rotate right by 90°
                conn.request( "{\"robotmove\":\"turnRight\", \"time\":300}");
                cleaned += "r";

                continue;
            }
            if(heading == UP)
            {
                // rotate right by 90°
                conn.request( "{\"robotmove\":\"turnRight\", \"time\":300}");
                cleaned += "r";

                // step forward
                answer = conn.request( "{\"robotmove\":\"moveForward\", \"time\":50}");
                if(answer.contains("collision"))
                    break;
                else cleaned += "f";

                // rotate left by 90°
                conn.request( "{\"robotmove\":\"turnLeft\", \"time\":300}");
                cleaned += "l";

                continue;
            }

        }

    }

    @After
    public void printResults() {
        System.out.println(cleaned);
    }
}
</pre>



<h2>Project</h2> 
 

<h2>Testing</h2> 
 

<h2>Deployment</h2> 

 
<h2>Maintenance</h2> 
 
<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div float="left" style="width: 80%; background-color: rgba(86, 56, 253, 0.9); color:white; font-family: Tahoma;">
	<span style="float: left; width: 60%; padding: 10px">
		By <b>Michele Righi</b><br/><br/>
		<span><b>ISS repo: <a id="issRepo" style="color:white" href="https://github.com/mikyll/righimichele/tree/master/iss2022">mikyll/righimichele/iss2022/</a></b></span><br/><br/>
		Contacts:<br/>
		e-mail: michele.righi5@studio.unibo.it<br/>
		GitHub: <a id="github" style="color:white" href="https://github.com/mikyll">mikyll</a><br/>
		LinkedIn: <a id="issRepo" style="color:white" href="https://www.linkedin.com/in/michele-righi/">Michele Righi</a><br/>
	</span>
	<img src="./img/Michele Righi avatar.png" alt="Michele Avatar" width="30%" height="30%"/>
</div>
<img  style="float: right; border: none; padding-bottom: 10px; padding-right: 10px" src="./img/NoWarUkraineDoveColored.png" alt="No War Ukraine" width="10%" height="10%"/>

</body>
</html>
